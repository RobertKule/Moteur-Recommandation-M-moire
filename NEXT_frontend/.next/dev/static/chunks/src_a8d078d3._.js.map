{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/clients/MemoBot/frontend/src/lib/api.ts"],"sourcesContent":["// src/lib/api.ts - VERSION COMPL√àTE CORRIG√âE\r\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';\r\n\r\n// ========== TYPES D√âFINIS EN PREMIER ==========\r\n\r\nexport interface User {\r\n  id: number;\r\n  email: string;\r\n  full_name: string;\r\n  role: 'admin' | 'enseignant' | 'etudiant';\r\n  is_active: boolean;\r\n  created_at: string;\r\n}\r\n\r\nexport interface UserProfile {\r\n  id?: number;\r\n  user_id: number;\r\n  bio?: string;\r\n  location?: string;\r\n  university?: string;\r\n  field?: string;\r\n  level?: string;\r\n  interests?: string;\r\n  phone?: string;\r\n  website?: string;\r\n  linkedin?: string;\r\n  github?: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface UserSkill {\r\n  id: number;\r\n  user_id: number;\r\n  name: string;\r\n  level: number;\r\n  category?: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface UserStats {\r\n  profile_completion: number;\r\n  explored_subjects: number;\r\n  recommendations_count: number;\r\n  active_days: number;\r\n  last_active: string;\r\n}\r\n\r\nexport interface Sujet {\r\n  id: number;\r\n  titre: string;\r\n  keywords: string;\r\n  domaine: string;\r\n  facult√©: string;\r\n  niveau: string;\r\n  probl√©matique: string;\r\n  m√©thodologie?: string;\r\n  technologies?: string;\r\n  description: string;\r\n  difficult√©: 'facile' | 'moyenne' | 'difficile';\r\n  dur√©e_estim√©e?: string;\r\n  ressources?: string;\r\n  vue_count: number;\r\n  like_count: number;\r\n  is_active: boolean;\r\n  created_at: string;\r\n}\r\n\r\nexport interface RecommendedSujet {\r\n  sujet: Sujet;\r\n  score: number;\r\n  raisons: string[];\r\n  crit√®res_respect√©s: string[];\r\n}\r\n\r\nexport interface AIResponse {\r\n  question: string;\r\n  r√©ponse: string;\r\n  suggestions: string[];\r\n}\r\n\r\n\r\nexport interface GeneratedSubject {\r\n  titre: string;\r\n  probl√©matique: string;\r\n  keywords: string;\r\n  description: string;\r\n  methodologie: string;\r\n  difficult√©: string;\r\n  dur√©e_estim√©e: string;\r\n}\r\n\r\nexport interface AIAnalysisResponse {\r\n  pertinence: number;\r\n  points_forts: string[];\r\n  points_faibles: string[];\r\n  suggestions: string[];\r\n  recommandations: string[];\r\n}\r\n\r\nexport interface AcceptanceCriteria {\r\n  crit√®res_acceptation: string[];\r\n  crit√®res_rejet: string[];\r\n  conseils_pratiques: string[];\r\n}\r\n\r\nexport interface UserPreference {\r\n  id: number;\r\n  user_id: number;\r\n  interests?: string;\r\n  faculty?: string;\r\n  level?: string;\r\n  created_at: string;\r\n  updated_at?: string;\r\n}\r\n\r\nexport interface Feedback {\r\n  id: number;\r\n  user_id: number;\r\n  sujet_id: number;\r\n  rating?: number;\r\n  pertinence?: number;\r\n  commentaire?: string;\r\n  int√©ress√©: boolean;\r\n  s√©lectionn√©: boolean;\r\n  created_at: string;\r\n}\r\n\r\nexport interface StatsDomains {\r\n  domaine: string;\r\n  count: number;\r\n  avg_views: number;\r\n}\r\n\r\nexport interface PopularKeyword {\r\n  keyword: string;\r\n  count: number;\r\n}\r\n\r\nexport interface HealthCheck {\r\n  status: string;\r\n  service: string;\r\n}\r\n\r\nexport interface Config {\r\n  database_url: string;\r\n  gemini_api_key: string;\r\n  environment: string;\r\n}\r\n\r\n// ========== CLASSE API SERVICE ==========\r\nclass ApiService {\r\n  private async request<T>(\r\n    endpoint: string,\r\n    options: RequestInit = {}\r\n  ): Promise<T> {\r\n    const url = `${API_BASE_URL}${endpoint}`;\r\n    \r\n    console.log('üîÑ API Request:', {\r\n      url,\r\n      endpoint,\r\n      method: options.method || 'GET'\r\n    });\r\n\r\n    const headers: Record<string, string> = {\r\n      'Content-Type': 'application/json',\r\n      ...options.headers,\r\n    };\r\n\r\n    // R√©cup√©rer le token depuis localStorage seulement c√¥t√© client\r\n    let token: string | null = null;\r\n    if (typeof window !== 'undefined') {\r\n      token = localStorage.getItem('access_token');\r\n      console.log('Token available:', !!token);\r\n    }\r\n\r\n    if (token) {\r\n      headers['Authorization'] = `Bearer ${token}`;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(url, {\r\n        ...options,\r\n        headers,\r\n        credentials: 'include',\r\n      });\r\n\r\n      console.log('üì° API Response:', {\r\n        url,\r\n        status: response.status,\r\n        statusText: response.statusText,\r\n        ok: response.ok\r\n      });\r\n\r\n      // Si erreur 401, nettoyer le token\r\n      if (response.status === 401) {\r\n        console.log('Unauthorized, removing token');\r\n        if (typeof window !== 'undefined') {\r\n          localStorage.removeItem('access_token');\r\n        }\r\n        throw new Error('Session expir√©e. Veuillez vous reconnecter.');\r\n      }\r\n\r\n      if (!response.ok) {\r\n        let errorData;\r\n        try {\r\n          errorData = await response.json();\r\n          console.error('‚ùå API Error Details:', errorData);\r\n        } catch {\r\n          const errorText = await response.text();\r\n          errorData = { detail: errorText || `HTTP ${response.status}: ${response.statusText}` };\r\n        }\r\n        \r\n        const errorMessage = typeof errorData === 'object' \r\n          ? (errorData.detail || errorData.message || JSON.stringify(errorData))\r\n          : errorData;\r\n        \r\n        throw new Error(errorMessage);\r\n      }\r\n\r\n      // Si la r√©ponse est vide (ex: DELETE), retourner true\r\n      if (response.status === 204) {\r\n        return true as T;\r\n      }\r\n\r\n      const data = await response.json();\r\n      console.log('‚úÖ API Success:', data);\r\n      return data;\r\n    } catch (error) {\r\n      console.error('üî• API Request failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // ========== AUTH ==========\r\n  async login(email: string, password: string) {\r\n    return this.request<{ access_token: string; token_type: string }>('/auth/login-json', {\r\n      method: 'POST',\r\n      body: JSON.stringify({ email, password }),\r\n    });\r\n  }\r\n\r\n  async register(data: {\r\n    email: string;\r\n    full_name: string;\r\n    password: string;\r\n    role: 'admin' | 'enseignant' | 'etudiant';\r\n  }) {\r\n    return this.request<User>('/auth/register', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  }\r\n\r\n  async getCurrentUser() {\r\n    return this.request<User>('/auth/me');\r\n  }\r\n\r\n  async forgotPassword(email: string) {\r\n    return this.request('/auth/forgot-password', {\r\n      method: 'POST',\r\n      body: JSON.stringify({ email }),\r\n    });\r\n  }\r\n\r\n  async resetPassword(token: string, new_password: string) {\r\n    return this.request('/auth/reset-password', {\r\n      method: 'POST',\r\n      body: JSON.stringify({ token, new_password }),\r\n    });\r\n  }\r\n\r\n  // ========== SUJETS ==========\r\n  async getSujets(params?: {\r\n    search?: string;\r\n    domaine?: string;\r\n    facult√©?: string;\r\n    niveau?: string;\r\n    skip?: number;\r\n    limit?: number;\r\n  }) {\r\n    const query = new URLSearchParams(\r\n      params ? Object.entries(params).filter(([_, v]) => v !== undefined) : []\r\n    ).toString();\r\n    return this.request<Sujet[]>(`/sujets?${query}`);\r\n  }\r\n\r\n  async getSujet(id: number) {\r\n    return this.request<Sujet>(`/sujets/${id}`);\r\n  }\r\n\r\n  async recommendSujets(data: {\r\n    interests: string[];\r\n    niveau?: string;\r\n    facult√©?: string;\r\n    domaine?: string;\r\n    difficult√©?: string;\r\n    limit?: number;\r\n  }) {\r\n    return this.request<RecommendedSujet[]>('/sujets/recommend', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  }\r\n\r\n  // ========== IA ==========\r\n  async askAI(question: string, context?: string) {\r\n    return this.request<AIResponse>('/ai/ask', {\r\n      method: 'POST',\r\n      body: JSON.stringify({ question, context }),\r\n    });\r\n  }\r\n\r\n  async generateSubjects(data: {\r\n    interests: string[];\r\n    domaine?: string;\r\n    niveau?: string;\r\n    facult√©?: string;\r\n    count?: number;\r\n  }) {\r\n    return this.request<GeneratedSubject[]>('/ai/generate', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  }\r\n\r\n  async analyzeSubject(data: {\r\n    titre: string;\r\n    description: string;\r\n    domaine?: string;\r\n    niveau?: string;\r\n    facult√©?: string;\r\n    probl√©matique?: string;\r\n    keywords?: string;\r\n    context?: string;\r\n  }) {\r\n    return this.request<AIAnalysisResponse>('/ai/analyze', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  }\r\n\r\n  async getAcceptanceCriteria() {\r\n    return this.request<AcceptanceCriteria>('/ai/criteria');\r\n  }\r\n\r\n  async getTips() {\r\n    return this.request<{\r\n      choix_sujet: string[];\r\n      methodologie: string[];\r\n      redaction: string[];\r\n      soutenance: string[];\r\n    }>('/ai/tips');\r\n  }\r\n\r\n  // ========== PREFERENCES ==========\r\n  async getPreferences() {\r\n    return this.request<UserPreference>('/users/me/preferences');\r\n  }\r\n\r\n  async updatePreferences(data: Partial<UserPreference>) {\r\n    return this.request<UserPreference>('/users/me/preferences', {\r\n      method: 'PUT',\r\n      body: JSON.stringify(data),\r\n    });\r\n  }\r\n\r\n  // ========== USERS ==========\r\n  async getUserProfile(userId: number): Promise<UserProfile> {\r\n    try {\r\n      return await this.request<UserProfile>(`/users/${userId}/profile`);\r\n    } catch (error) {\r\n      console.log('Using mock profile data');\r\n      // Donn√©es mock temporaires\r\n      return {\r\n        user_id: userId,\r\n        bio: '',\r\n        location: '',\r\n        university: '',\r\n        field: '',\r\n        level: '',\r\n        interests: '',\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString()\r\n      };\r\n    }\r\n  }\r\n\r\n  async getUserSkills(userId: number): Promise<UserSkill[]> {\r\n    try {\r\n      return await this.request<UserSkill[]>(`/users/${userId}/skills`);\r\n    } catch (error) {\r\n      console.log('Using mock skills data');\r\n      return [];\r\n    }\r\n  }\r\n\r\n  async getUserStats(userId: number): Promise<UserStats> {\r\n    try {\r\n      return await this.request<UserStats>(`/users/${userId}/stats`);\r\n    } catch (error) {\r\n      console.log('Using mock stats data');\r\n      return {\r\n        profile_completion: 0,\r\n        explored_subjects: 0,\r\n        recommendations_count: 0,\r\n        active_days: 0,\r\n        last_active: new Date().toISOString()\r\n      };\r\n    }\r\n  }\r\n\r\n  async updateUserProfile(userId: number, data: Partial<UserProfile>): Promise<UserProfile> {\r\n    try {\r\n      return await this.request<UserProfile>(`/users/${userId}/profile`, {\r\n        method: 'PUT',\r\n        body: JSON.stringify(data),\r\n      });\r\n    } catch (error) {\r\n      console.log('Mock update profile');\r\n      // Simulation de mise √† jour\r\n      return {\r\n        user_id: userId,\r\n        ...data,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString()\r\n      } as UserProfile;\r\n    }\r\n  }\r\n\r\n  async updateUserSkills(userId: number, skills: UserSkill[]) {\r\n    return this.request<UserSkill[]>(`/users/${userId}/skills`, {\r\n      method: 'PUT',\r\n      body: JSON.stringify({ skills }),\r\n    });\r\n  }\r\n\r\n  // ========== FEEDBACK ==========\r\n  async submitFeedback(data: {\r\n    sujet_id: number;\r\n    rating?: number;\r\n    pertinence?: number;\r\n    commentaire?: string;\r\n    int√©ress√©?: boolean;\r\n    s√©lectionn√©?: boolean;\r\n  }) {\r\n    return this.request<Feedback>('/sujets/feedback', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  }\r\n\r\n  // ========== STATS ==========\r\n  async getPopularSujets(limit: number = 10) {\r\n    return this.request<Sujet[]>(`/sujets/stats/popular?limit=${limit}`);\r\n  }\r\n\r\n  async getPopularKeywords(limit: number = 20) {\r\n    return this.request<PopularKeyword[]>(\r\n      `/sujets/stats/keywords?limit=${limit}`\r\n    );\r\n  }\r\n\r\n  async getDomainsStats() {\r\n    return this.request<StatsDomains[]>(\r\n      '/sujets/stats/domains'\r\n    );\r\n  }\r\n\r\n  // ========== UTILITAIRES ==========\r\n  async healthCheck() {\r\n    return this.request<HealthCheck>('/health');\r\n  }\r\n\r\n  async getConfig() {\r\n    return this.request<Config>('/config');\r\n  }\r\n}\r\n\r\n// ========== EXPORT ==========\r\nexport const api = new ApiService();\r\n\r\n// Fonction utilitaire pour tester la connexion\r\nexport async function testBackendConnection() {\r\n  try {\r\n    console.log('Testing backend connection...');\r\n    const health = await fetch(`${API_BASE_URL}/health`);\r\n    console.log('Backend health:', await health.json());\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Backend not reachable:', error);\r\n    return false;\r\n  }\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 280, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/clients/MemoBot/frontend/src/contexts/AuthContext.tsx"],"sourcesContent":["// src/contexts/AuthContext.tsx\r\n'use client'\r\n\r\nimport React, { createContext, useContext, useEffect, useState } from 'react'\r\nimport { api, User } from '@/lib/api'\r\n\r\ninterface AuthContextType {\r\n  user: User | null\r\n  isLoading: boolean\r\n  login: (email: string, password: string) => Promise<User>\r\n  register: (data: {\r\n    email: string\r\n    full_name: string\r\n    password: string\r\n    role: 'etudiant' | 'enseignant' | 'admin'\r\n  }) => Promise<User>\r\n  logout: () => void\r\n  updateUser: (user: User) => void\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined)\r\n\r\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\r\n  const [user, setUser] = useState<User | null>(null)\r\n  const [isLoading, setIsLoading] = useState(true)\r\n\r\n  /**\r\n   * üîê Initialisation de l'auth (1 seule fois)\r\n   */\r\n  useEffect(() => {\r\n    let mounted = true\r\n\r\n    const initAuth = async () => {\r\n      try {\r\n        const token = localStorage.getItem('access_token')\r\n\r\n        if (!token) {\r\n  if (mounted) {\r\n    setUser(null)\r\n    setIsLoading(false) // üëà MANQUAIT ICI\r\n  }\r\n  return\r\n}\r\n\r\n\r\n        const userData = await api.getCurrentUser()\r\n        if (mounted) setUser(userData)\r\n\r\n      } catch (error) {\r\n        localStorage.removeItem('access_token')\r\n        if (mounted) setUser(null)\r\n\r\n      } finally {\r\n        if (mounted) setIsLoading(false)\r\n      }\r\n    }\r\n\r\n    initAuth()\r\n\r\n    return () => {\r\n      mounted = false\r\n    }\r\n  }, [])\r\n\r\n  /**\r\n   * üîë LOGIN\r\n   */\r\n  const login = async (email: string, password: string): Promise<User> => {\r\n    setIsLoading(true)\r\n\r\n    try {\r\n      const response = await api.login(email, password)\r\n\r\n      if (!response?.access_token) {\r\n        throw new Error('No access token received')\r\n      }\r\n\r\n      localStorage.setItem('access_token', response.access_token)\r\n\r\n      const userData = await api.getCurrentUser()\r\n      setUser(userData)\r\n\r\n      return userData\r\n\r\n    } catch (error: any) {\r\n      localStorage.removeItem('access_token')\r\n      setUser(null)\r\n      throw new Error(error.message || '√âchec de la connexion')\r\n\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üìù REGISTER\r\n   */\r\n  const register = async (data: {\r\n    email: string\r\n    full_name: string\r\n    password: string\r\n    role: 'etudiant' | 'enseignant' | 'admin'\r\n  }): Promise<User> => {\r\n    setIsLoading(true)\r\n\r\n    try {\r\n      await api.register(data)\r\n\r\n      const loginResponse = await api.login(data.email, data.password)\r\n\r\n      if (!loginResponse?.access_token) {\r\n        throw new Error('No access token after registration')\r\n      }\r\n\r\n      localStorage.setItem('access_token', loginResponse.access_token)\r\n\r\n      const userData = await api.getCurrentUser()\r\n      setUser(userData)\r\n\r\n      return userData\r\n\r\n    } catch (error: any) {\r\n      throw new Error(error.message || '√âchec de l‚Äôinscription')\r\n\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üö™ LOGOUT\r\n   */\r\n  const logout = () => {\r\n    localStorage.removeItem('access_token')\r\n    setUser(null)\r\n  }\r\n\r\n  /**\r\n   * üîÑ UPDATE USER\r\n   */\r\n  const updateUser = (updatedUser: User) => {\r\n    setUser(updatedUser)\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        isLoading,\r\n        login,\r\n        register,\r\n        logout,\r\n        updateUser,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  )\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext)\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider')\r\n  }\r\n  return context\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAGA;AACA;;;AAJA,+BAA+B;AAC/B;;;AAmBA,MAAM,4BAAc,IAAA,8KAAa,EAA8B;AAExD,SAAS,aAAa,EAAE,QAAQ,EAAiC;;IACtE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAc;IAC9C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAE3C;;GAEC,GACD,IAAA,0KAAS;kCAAC;YACR,IAAI,UAAU;YAEd,MAAM;mDAAW;oBACf,IAAI;wBACF,MAAM,QAAQ,aAAa,OAAO,CAAC;wBAEnC,IAAI,CAAC,OAAO;4BAClB,IAAI,SAAS;gCACX,QAAQ;gCACR,aAAa,QAAO,kBAAkB;4BACxC;4BACA;wBACF;wBAGQ,MAAM,WAAW,MAAM,2HAAG,CAAC,cAAc;wBACzC,IAAI,SAAS,QAAQ;oBAEvB,EAAE,OAAO,OAAO;wBACd,aAAa,UAAU,CAAC;wBACxB,IAAI,SAAS,QAAQ;oBAEvB,SAAU;wBACR,IAAI,SAAS,aAAa;oBAC5B;gBACF;;YAEA;YAEA;0CAAO;oBACL,UAAU;gBACZ;;QACF;iCAAG,EAAE;IAEL;;GAEC,GACD,MAAM,QAAQ,OAAO,OAAe;QAClC,aAAa;QAEb,IAAI;YACF,MAAM,WAAW,MAAM,2HAAG,CAAC,KAAK,CAAC,OAAO;YAExC,IAAI,CAAC,UAAU,cAAc;gBAC3B,MAAM,IAAI,MAAM;YAClB;YAEA,aAAa,OAAO,CAAC,gBAAgB,SAAS,YAAY;YAE1D,MAAM,WAAW,MAAM,2HAAG,CAAC,cAAc;YACzC,QAAQ;YAER,OAAO;QAET,EAAE,OAAO,OAAY;YACnB,aAAa,UAAU,CAAC;YACxB,QAAQ;YACR,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI;QAEnC,SAAU;YACR,aAAa;QACf;IACF;IAEA;;GAEC,GACD,MAAM,WAAW,OAAO;QAMtB,aAAa;QAEb,IAAI;YACF,MAAM,2HAAG,CAAC,QAAQ,CAAC;YAEnB,MAAM,gBAAgB,MAAM,2HAAG,CAAC,KAAK,CAAC,KAAK,KAAK,EAAE,KAAK,QAAQ;YAE/D,IAAI,CAAC,eAAe,cAAc;gBAChC,MAAM,IAAI,MAAM;YAClB;YAEA,aAAa,OAAO,CAAC,gBAAgB,cAAc,YAAY;YAE/D,MAAM,WAAW,MAAM,2HAAG,CAAC,cAAc;YACzC,QAAQ;YAER,OAAO;QAET,EAAE,OAAO,OAAY;YACnB,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI;QAEnC,SAAU;YACR,aAAa;QACf;IACF;IAEA;;GAEC,GACD,MAAM,SAAS;QACb,aAAa,UAAU,CAAC;QACxB,QAAQ;IACV;IAEA;;GAEC,GACD,MAAM,aAAa,CAAC;QAClB,QAAQ;IACV;IAEA,qBACE,6LAAC,YAAY,QAAQ;QACnB,OAAO;YACL;YACA;YACA;YACA;YACA;YACA;QACF;kBAEC;;;;;;AAGP;GAxIgB;KAAA;AA0IT,SAAS;;IACd,MAAM,UAAU,IAAA,2KAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANgB"}},
    {"offset": {"line": 422, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/clients/MemoBot/frontend/src/components/providers.tsx"],"sourcesContent":["// src/components/providers.tsx\r\n'use client'\r\n\r\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query'\r\nimport { Toaster } from 'react-hot-toast'\r\nimport { AuthProvider } from '@/contexts/AuthContext'  // CHANG√â ICI\r\nimport { useState } from 'react'\r\n\r\nexport function Providers({ children }: { children: React.ReactNode }) {\r\n  const [queryClient] = useState(() => new QueryClient({\r\n    defaultOptions: {\r\n      queries: {\r\n        staleTime: 60 * 1000,\r\n        retry: 1,\r\n      },\r\n    },\r\n  }))\r\n\r\n  return (\r\n    <QueryClientProvider client={queryClient}>\r\n      <AuthProvider>  {/* Maintenant, cela utilise votre vrai AuthContext */}\r\n        {children}\r\n        <Toaster \r\n          position=\"top-right\"\r\n          toastOptions={{\r\n            duration: 4000,\r\n            style: {\r\n              background: '#fff',\r\n              color: '#374151',\r\n              border: '1px solid #e5e7eb',\r\n            },\r\n          }}\r\n        />\r\n      </AuthProvider>\r\n    </QueryClientProvider>\r\n  )\r\n}"],"names":[],"mappings":";;;;;AAGA;AAAA;AACA;AACA,sOAAuD,aAAa;AACpE;;;AANA,+BAA+B;AAC/B;;;;;AAOO,SAAS,UAAU,EAAE,QAAQ,EAAiC;;IACnE,MAAM,CAAC,YAAY,GAAG,IAAA,yKAAQ;8BAAC,IAAM,IAAI,+LAAW,CAAC;gBACnD,gBAAgB;oBACd,SAAS;wBACP,WAAW,KAAK;wBAChB,OAAO;oBACT;gBACF;YACF;;IAEA,qBACE,6LAAC,gNAAmB;QAAC,QAAQ;kBAC3B,cAAA,6LAAC,kJAAY;;gBAAC;gBACX;8BACD,6LAAC,qKAAO;oBACN,UAAS;oBACT,cAAc;wBACZ,UAAU;wBACV,OAAO;4BACL,YAAY;4BACZ,OAAO;4BACP,QAAQ;wBACV;oBACF;;;;;;;;;;;;;;;;;AAKV;GA5BgB;KAAA"}}]
}